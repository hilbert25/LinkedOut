<!DOCTYPE html>
<html>
<head>
<title>Home</title>
<!--mobile apps-->
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="keywords" content="" />
<script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
<link href="../src/css/bootstrap.css" type="text/css" rel="stylesheet" media="all">
<link href="../src/css/style.css" type="text/css" rel="stylesheet" media="all">
<link rel="stylesheet" href="../src/css/swipebox.css">
<link href="../src/css/component.css" type="text/css" rel="stylesheet"  media="all">
<script src="../src/js/jquery-1.11.1.min.js"></script> 
<script type="text/javascript" src="../src/js/move-top.js"></script>
<script type="text/javascript" src="../src/js/easing.js"></script>	
<link rel="stylesheet" href="../src/css/bootstrap-select.css">

<style>
body {
padding-top: 70px;
}
.cls_select_span {  
            position:absolute;  
            border:1pt solid #c1c1c1;  
            overflow:hidden;  
            width:188px;  
            height:19px;  
            clip:rect(-1px 190px 190px 170px);  
        }  
        .cls_input_span {  
            position:absolute;  
            border-top:1pt solid #c1c1c1;  
            border-left:1pt solid #c1c1c1;  
            border-bottom:1pt solid #c1c1c1;  
            width:170px;  
            height:19px;  
        }  
        .cls_option_defined {  
            color:#c2c2c2;  
        }  
        .cls_select {  
            width:190px;  
            height:20px;  
            margin:-2px;  
        }  
        .cls_input {  
            width:170px;  
            height:19px;  
            border:0pt;  
            color:#ddd;
            border:1px solid #ddd;
        }  
</style>

<script src="../src/js/bootstrap-select.js" defer></script>
<script type="text/javascript">
		jQuery(document).ready(function($) {
			$(".scroll").click(function(event){		
				event.preventDefault();
				$('html,body').animate({scrollTop:$(this.hash).offset().top},1000);
			});
		});
</script>
</head>
<body>
	<div id="home" class="banner">
		<div class="banner-info">
			<div class="container">
				<div class="col-md-8 header-right">
					<h2>Hello</h2>
					<h1>I'm Christopher Doe</h1>
					<ul class="address">
						<li>
							<ul class="address-text">
								<li><b>姓名 </b></li>
								<li id="name"></li>
							</ul>
						</li>
						<li>
							<ul class="address-text">
								<li><b>性别 </b></li>
								<li id="gender"></li>
							</ul>
						</li>
						<li>
							<ul class="address-text">
								<li><b>生日 </b></li>
								<li id="birth"></li>
							</ul>
						</li>
						<li>
							<ul class="address-text">
								<li><b>E-MAIL </b></li>
								<li id="email"></li>
							</ul>
						</li>
						<li>
							<ul class="address-text">
								<li><b>手机号码 </b></li>
								<li id="phone_number"></li>
							</ul>
						</li>
						<li>
						</li>
					</ul>
                    <td><a href="javascript:;" class="md-trigger btn btn-primary btn-sm" data-modal="modal-13">修改基本信息</a></td>
				</div>
				<div class="clearfix"> </div>
			</div>
		</div>
	</div>
	<div class="top-nav wow">
		<div class="container">
			<div class="navbar-header logo">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
					Menu
				</button>
			</div>
			<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
				<div class="menu">
					<ul class="nav navbar">
						<li><a href="#about" class="scroll">About</a></li>
						<li><a href="#work" class="scroll">Experience</a></li>
						<li><a href="#education" class="scroll">Education</a></li>
					</ul>
					<div class="clearfix"> </div>
				</div>
			</div>
		</div>
	</div>	
	<div id="work" class="work">
		<div class="container" id="work_list">
			<h3 class="title">Work Experience</h3>
			</div>
			<div class="container" id="add_work">
					<div class="work-info"> 
							<div class="col-md-6 work-right work-right2"> 
								<h4>点左边添加一条工作经历</h4>
							</div>
							<div class="col-md-6 work-left work-left2"> 
								<h5> <span class="glyphicon glyphicon-education" onclick="addWorkExp()"></span></h5>
							</div>
					</div>
			</div>
		</div>
	</div>
	<div id="education" class="education">
		<div class="container" id="edu_list">
			<h3 class="title">Education Experience</h3>
			</div>
			<div class="container" id="add_edu">
				<div class="work-info"> 
					<div class="col-md-6 work-left"> 
						<h4>点右边添加一条教育经历</h4>
					</div>
					<div class="col-md-6 work-right"> 
						<h5><span class="glyphicon glyphicon-education"  onclick="addEduExp()"> </span></h5>
						<p></p>
					</div>
					<div class="clearfix"> </div>
				</div>
			</div>
		</div>
	</div>
    
	<!-- 基本信息 -->
	<div class="md-modal md-effect-13" id="modal-13">
		<div class="md-content">
			<h3>修改个人信息</h3>
			<div class="form-group">
				<label>姓名</label>
				<input type="text" class="form-control" id="new_name">
				<label>性别</label>
				<input type="text" id="id_input" value="可选择也可自定义输入">
					<select id="new_gender" class="selectpicker" data-hide-disabled="true" data-live-search="true" onChange="selectOnChangeFunc()">
						<optgroup disabled="disabled" label="disabled">
							<option>Hidden</option>
						</optgroup>
							<option>男</option>
							<option>女</option>
					</select>
				<br></br>
				<label>出生日期</label>
				<input type="date" class="form-control" id="new_birth">
				<label>电子邮件</label>
				<input type="email" class="form-control"  id="new_email">
				<label>手机号码</label>
				<input type="text" class="form-control"  id="new_phone_number">
			</div>
			<input type="button" class="md-trigger btn btn-primary btn-sm" onclick="saveBasicInfo()" value="提交"></input>
			</div>
		</div>
	</div>
	<!-- 添加工作经历 -->
	<div class="md-modal md-effect-13" id="modal-work-exp">
			<div class="md-content">
				<h3> 添加工作经历</h3>
				<div class="form-group">
                    <label>公司</label>
                    <input type="test" class="form-control"  id="new_company_name">
					<!-- <input type="text" class="form-control" id="new_company_name"> -->
					<!-- <label style="padding-left:10px;padding-right:200px;"> 
						<span class="cls_select_span">  
        				<select id="id_select" class="cls_select" onChange="selectOnChangeFunc()">  
            				<option value="" class="cls_option_defined">---自定义---</option>  
            				<option value="开发部">开发部</option>  
            				<option value="市场部">市场部</option>  
            				<option value="销售部">销售部</option>  
        				</select>  
    				   </span>  
    				    <span >  
    				        <input type="text" id="id_input" class="cls_input" placeholder="可选择也可自定义输入">  
    				    </span>
					</label>  -->
					<label>开始时间</label>
					<input type="date" class="form-control"  id="new_work_begin_time">
					<label>结束时间</label>
					<input type="date" class="form-control" id="new_work_end_time">
					<label>职务</label>
					<input type="email" class="form-control"  id="new_work_position">
					<label>工作内容</label>
					<input type="text" class="form-control"  id="new_work_content">
				</div>
                <input type="button" class="md-trigger btn btn-primary btn-sm" onclick="saveWorkExp()" value="提交"></input>
                <input type="button" class="md-trigger btn btn-primary btn-sm" onclick="confirmWorkExp()" value="认证"></input>
				</div>
			</div>
		</div>

		<!-- 添加教育经历 -->
	<div class="md-modal md-effect-13" id="modal-edu-exp">
		<div class="md-content">
			<h3> 添加教育经历</h3>
			<div class="form-group">
				<label>学校</label>
				<input type="text" class="form-control" id="new_school_name">
				<label>专业</label>
				<input type="text" class="form-control" id="new_major_name">
				<label>学位</label>
				<input type="text" class="form-control" id="new_degree_name">
				<label>开始时间</label>
				<input type="date" class="form-control"  id="new_edu_begin_time">
				<label>结束时间</label>
				<input type="date" class="form-control" id="new_edu_end_time">
			</div>
			<input type="button" class="md-trigger btn btn-primary btn-sm" onclick="saveEduExp()" value="提交"></input>
			</div>
		</div>
	</div>
		  <div class="md-overlay"></div>
	<script type="text/javascript">
		$(document).ready(function() {
		
			var defaults = {
				containerID: 'toTop', // fading element id
				containerHoverID: 'toTopHover', // fading element hover id
				scrollSpeed: 1200,
				easingType: 'linear' 
			};
			
			$().UItoTop({ easingType: 'easeOutQuart' });
			
		});
	</script>
	<script src="../src/js/classie.js"></script>
	<script src="../src/js/modalEffects.js"></script>
	<script src="../src/js/bootstrap.js"></script>
	<script src="../libs/nebulas.js"></script>
	<script src="../libs/nebPay.js"></script>
	<script type="text/javascript" src="../libs/util.js"></script>
	<script type="text/javascript">
		"use strict";
		var nebulas = require("nebulas");
		var Account = nebulas.Account;
		var neb = new nebulas.Neb();
		var NebPay = require("nebpay");
		var nebPay = new NebPay();
		var dappAddress = getContractAddress();
		var EMAIL="";
		async function getData(args){
			neb.setRequest(new nebulas.HttpRequest("https://testnet.nebulas.io"));
			var serialNumber;
			var from = Account.NewAccount().getAddressString();
			var value = "0";   
			var nonce = "0";   
			var gas_price = "1000000" 
			var gas_limit = "2000000" ; 
			var contract = { 
				"function": "get",  
				"args": "[\""+args+"\"]"           
			};
			var r = await (neb.api.call(from, dappAddress, value, nonce, gas_price, gas_limit, contract).then(function (res) {
				return res['result'];  
			}));
			return r;
		}
		async function setData(value){
			value = value.replace(/"/g,"'");
			neb.setRequest(new nebulas.HttpRequest("https://testnet.nebulas.io"));
			nebPay.call(dappAddress, "0", "set", '["' + value+ '"]', {
				listener : function (resp) {
                    console.log(resp);
                    // 清空信息
                    $("#title").val("");
                    $("#content").val("");

                    // 延迟5秒执行
                    intervalQuery = setInterval(function () {
                        queryResultInfo();
                    }, 5000);
                }
			});
		}
		  // 定时器
		var intervalQuery;
        // 根据交易流水号查询执行结果数据
        function queryResultInfo() {
            nebPay.queryPayInfo()
                .then(function (resp) {
                    $("#result").val(resp);
                    var respObject = JSON.parse(resp)
                    if(respObject.code === 0){
                        alert(`提交信息成功!`);
                        clearInterval(intervalQuery);
                    }
                })
                .catch(function (err) {
                   console.log(err);
                })
		}
		///////////////////////////////////////////////

		async function getResume(){
			console.log(EMAIL+RESUME);
			var resume = await getData(EMAIL+RESUME);
			return resume;
        }
        
        function saveResume(){
            var basicInfoItem = ["name","gender","email","birth","phone_number"];
            var workExpItem = ["company_name","work_begin_time","work_end_time","work_position","work_content"];
            var eduExpItem = ["school_name","major_name","degree_name","edu_begin_time","edu_end_time"];
            var data={};
            var resume = {};
            for(var i=0;i<basicInfoItem.length;i++){
                resume[basicInfoItem[i]] = document.getElementById(basicInfoItem[i]).value;
            }
            resume["work_exp"] = [];
            console.log(getWorkInfoCount());
            for(var i=1;i<getWorkInfoCount+1;i++){
                console.log(i);
                var workExp = {};
                for(var j=0;j<workExpItem.length;j++){
                    workExp[workExpItem[j]]=document.getElementById(workExpItem[j]+i).value;
                }  
                resume["work_exp"].push(workExp);
            }
            resume["edu_exp"] = [];
            for(var i=1;i<getEduInfoCount+1;i++){
                var eduExp = {};
                for(var j=0;j<eduExpItem.length;j++){
                    eduExp[eduExpItem[j]]=document.getElementById(eduExpItem[j]+i).value;
                }
                resume["edu_exp"].push(eduExp);  
            }
            console.log(dicToMyJSON(resume));
        }
		function saveBasicInfo(){
            var basicInfoItem=["name","gender","email","birth","phone_number"];
            var data = {};
            var basicInfo = {};
			for(var i=0;i<basicInfoItem.length; i++){
				var item = document.getElementById(basicInfoItem[i]);
                var new_item =  document.getElementById("new_"+basicInfoItem[i]);
                item.innerHTML=new_item.value;
                basicInfo[basicInfoItem[i]] = new_item.value;
            }
            data[EMAIL+"-"+BASIC_INFO] = basicInfo;
            setData(dicToMyJSON(data));
			var model_13 = document.getElementById("modal-13");
			model_13.setAttribute("class","md-modal md-effect-13");
		}
		function setBasicInfo(resume){//链上读取数据并显示
			var basicInfoItem=["name","gender","email","birth","phone_number"];
			if(resume !=null){
				for(var i=0;i<basicInfoItem.length; i++){
					var item = document.getElementById(basicInfoItem[i]);
					var new_item =  document.getElementById("new_"+basicInfoItem[i]);
					item.innerHTML=resume[basicInfoItem[i]];
					new_item.value=resume[basicInfoItem[i]];
				}
			}
			
		}

		function addWorkExp(){
			var add_work_exp = document.getElementById("modal-work-exp");
			add_work_exp.setAttribute("class","md-modal md-effect-13 md-show");
		}

		function saveWorkExp(){
            Promise.resolve(getData(EMAIL+"-"+WORK_EXP)).then(function (resume) { 
                    var old_data;
                    if(resume!="null"){
                        old_data = myJSONParse(resume);
                    }else{
                        old_data = [];
                    }
					console.log(old_data);
                    var work = {};
                    var work_list = document.getElementById("work_list");
                    var add_work_exp = document.getElementById("modal-work-exp");
                    var work_info = document.createElement("div");
                    var index = getWorkInfoCount()+1;
                    work_info.setAttribute("class","work-info");
                    work_info.setAttribute("id","work-info"+index);
                    
                    var work_time = document.createElement("div");
                    work_time.setAttribute("class","col-md-6 work-left");
                    var work_beigin_time = document.createElement("h4");
                    work_beigin_time.setAttribute("id","work_begin_time"+index);
                    work_beigin_time.innerHTML=document.getElementById("new_work_begin_time").value;
                    work["work_begin_time"] = document.getElementById("new_work_begin_time").value;
                    work_time.appendChild(work_beigin_time);
                    var work_end_time = document.createElement("h4");
                    work_end_time.setAttribute("id","work_end_time"+index);
                    work["work_end_time"] = document.getElementById("new_work_end_time").value;
                    work_end_time.innerHTML=document.getElementById("new_work_end_time").value;
                    work_time.appendChild(work_end_time);
                    work_info.appendChild(work_time);
                    
                    var exp = document.createElement("div");
                    exp.setAttribute("class","col-md-6 work-right");

                    var h5 = document.createElement("h5");
                    var span = document.createElement("span");
                    span.setAttribute("class","glyphicon glyphicon-education");
                    h5.appendChild(span);
                    h5.setAttribute("id","company_name"+index);
                    h5.innerHTML = document.getElementById("new_company_name").value;
                    work["company_name"] = document.getElementById("new_company_name").value;
                    
                    var position = document.createElement("p");
                    position.innerHTML = document.getElementById("new_work_position").value;
                    work["work_position"] = document.getElementById("new_work_position").value;
                    position.setAttribute("id","work_position"+index);
                    var content = document.createElement("p");
                    content.innerHTML = document.getElementById("new_work_content").value;
                    work["work_content"] = document.getElementById("new_work_content").value;
                    content.setAttribute("id","work_content"+index);
                    
                    exp.appendChild(h5);
                    exp.appendChild(position)
                    exp.appendChild(content)
                    work_info.appendChild(exp);
                    work_list.appendChild(work_info);
                    old_data.push(work);
                    var new_data ={};
                    new_data[EMAIL+"-"+WORK_EXP] = old_data;
					setData(dicToMyJSON(new_data));
                    add_work_exp.setAttribute("class","md-modal md-effect-13");
				})
		}
		function getWorkInfoCount(){
            var count = 0;
			for(var i=1;;i++){
                if(document.getElementById("work_info"+i)){
                    count =i;
                }else{
                    break;
                }
            }
            return count;
		}





		function addEduExp(){
			var add_edu_exp = document.getElementById("modal-edu-exp");
			add_edu_exp.setAttribute("class","md-modal md-effect-13 md-show");
		}

		function saveEduExp(){
            var edu_list = document.getElementById("edu_list");
			var add_edu_exp = document.getElementById("modal-edu-exp");
            var edu_info = document.createElement("div");
            var index = getWorkInfoCount()+1;
			edu_info.setAttribute("class","work-info");
			edu_info.setAttribute("id","edu-info"+index);

            
            
            var edu_time = document.createElement("div");
			edu_time.setAttribute("class","col-md-6 work-left");
            var edu_beigin_time = document.createElement("h4");
            edu_beigin_time.setAttribute("id","edu_begin_time"+index);
			edu_beigin_time.innerHTML=document.getElementById("new_edu_begin_time").value;
            edu_time.appendChild(edu_beigin_time);
            var edu_end_time = document.createElement("h4");
            edu_end_time.innerHTML=document.getElementById("new_edu_end_time").value;
            edu_end_time.setAttribute("id","edu_end_time"+index);
			edu_time.appendChild(edu_end_time);
            edu_info.appendChild(edu_time);


			var exp = document.createElement("div");
			exp.setAttribute("class","col-md-6 work-right");

			var h5 = document.createElement("h5");
			var span = document.createElement("span");
			span.setAttribute("class","glyphicon glyphicon-education");
            h5.appendChild(span);
            h5.setAttribute("id","school_name"+index);
			h5.innerHTML = document.getElementById("new_school_name").value;
            
            var major = document.createElement("p");
            major.setAttribute("id","major_name"+index);
            major.innerHTML = document.getElementById("new_major_name").value;
            var degree = document.createElement("p");
            degree.setAttribute("id","degree_name"+index);
            degree.innerHTML = document.getElementById("new_degree_name").value;
            
            exp.appendChild(h5);
            exp.appendChild(major)
			exp.appendChild(degree)
			edu_info.appendChild(exp);
			edu_list.appendChild(edu_info);
            

			add_edu_exp.setAttribute("class","md-modal md-effect-13");
		}

		function getEduInfoCount(){
			var count = 0;
			for(var i=1;;i++){
                if(document.getElementById("edu_info"+i)){
                    count =i;
                }else{
                    break;
                }
            }
            return count;
		}

		function selectOnChangeFunc() {  
            document.getElementById('id_input').value = document.getElementById('new_gender').options[document.getElementById('new_gender').selectedIndex].value;  
        }

		window.onload=function(){
			EMAIL = location.search.substring(1,location.search.length);
			Promise.resolve(getResume()).then(function (resume) { 
					resume = myJSONParse(resume);
					console.log(resume);
					setBasicInfo(resume);
					if(resume == null){
						return;
					}
				})
			}
		</script>
</body>
</html>
